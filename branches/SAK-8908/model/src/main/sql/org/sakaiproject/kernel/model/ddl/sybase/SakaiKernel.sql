CREATE TABLE SAKAI_SITE_TOOL (ID int NOT NULL, LAYOUT_HINTS varchar(99) NULL, PAGE_ID varchar(99) NOT NULL, PAGE_ORDER int NOT NULL, REGISTRATION varchar(99) NOT NULL, SITE_ID varchar(99) NOT NULL, TITLE varchar(99) NULL, TOOL_ID varchar(99) NOT NULL, PRIMARY KEY (ID));
CREATE TABLE content_resource_delete (BINARY_ENTITY image NULL, CONTEXT varchar(99) NULL, DELETE_DATE datetime NULL, DELETE_USERID varchar(36) NULL, FILE_PATH varchar(128) NULL, FILE_SIZE int NULL, ID int NOT NULL, IN_COLLECTION varchar(255) NULL, RESOURCE_ID varchar(255) NOT NULL, RESOURCE_TYPE_ID varchar(255) NULL, RESOURCE_UUID varchar(36) NULL, XML text NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_preferences (ID int NOT NULL, PREFERENCES_ID varchar(99) NOT NULL, XML text NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_locks (LOCK_TIME datetime NULL, RECORD_ID varchar(512) NULL, TABLE_NAME varchar(64) NULL, USAGE_SESSION_ID varchar(36) NULL, id int NOT NULL, PRIMARY KEY (id));
CREATE TABLE SAKAI_USER_PROPERTY (NAME varchar(99) NOT NULL, USER_ID varchar(99) NOT NULL, VALUE text NULL, PRIMARY KEY (NAME, USER_ID));
CREATE TABLE sakai_site (CREATEDBY varchar(99) NULL, CREATEDON datetime NULL, CUSTOM_PAGE_ORDERED char(1) NULL, DESCRIPTION text NULL, ICON_URL varchar(255) NULL, ID int NOT NULL, INFO_URL varchar(255) NULL, IS_SPECIAL char(1) NULL, IS_USER char(1) NULL, JOINABLE char(1) NULL, JOIN_ROLE varchar(99) NULL, MODIFIEDBY varchar(99) NULL, MODIFIEDON datetime NULL, PUBLISHED int NULL, PUBVIEW char(1) NULL, SHORT_DESC text NULL, SITE_ID varchar(99) NOT NULL, SKIN varchar(255) NULL, TITLE varchar(99) NULL, TYPE varchar(99) NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_event (EVENT varchar(32) NULL, EVENT_CODE varchar(1) NULL, EVENT_DATE datetime NULL, EVENT_ID int NOT NULL, ID int NOT NULL, REF varchar(255) NULL, SESSION_ID varchar(163) NULL, PRIMARY KEY (ID));
CREATE TABLE content_resource_lock (asset_id varchar(36) NULL, date_added datetime NULL, date_removed datetime NULL, id int NOT NULL, is_active bit NULL, is_system bit NULL, qualifier_id varchar(36) NULL, reason varchar(36) NULL, PRIMARY KEY (id));
CREATE TABLE sakai_session (ID int NOT NULL, SESSION_ACTIVE bit NULL, SESSION_END datetime NULL, SESSION_ID varchar(36) NOT NULL, SESSION_IP varchar(128) NULL, SESSION_SERVER varchar(64) NULL, SESSION_START datetime NULL, SESSION_USER varchar(99) NULL, SESSION_USER_AGENT varchar(255) NULL, PRIMARY KEY (ID));
CREATE TABLE SAKAI_REALM_PROPERTY (NAME varchar(99) NOT NULL, REALM_KEY int NOT NULL, VALUE text NULL, PRIMARY KEY (NAME, REALM_KEY));
CREATE TABLE SAKAI_ALIAS_PROPERTY (ALIAS_ID varchar(99) NOT NULL, NAME varchar(99) NOT NULL, VALUE text NULL, PRIMARY KEY (ALIAS_ID, NAME));
CREATE TABLE sakai_site_user (PERMISSION int NOT NULL, SITE_ID varchar(99) NOT NULL, USER_ID varchar(99) NOT NULL, PRIMARY KEY (SITE_ID, USER_ID));
CREATE TABLE sakai_site_page_property (NAME varchar(99) NOT NULL, PAGE_ID varchar(99) NOT NULL, SITE_ID varchar(99) NOT NULL, VALUE text NULL, PRIMARY KEY (NAME, PAGE_ID));
CREATE TABLE sakai_site_group_property (GROUP_ID varchar(99) NOT NULL, NAME varchar(99) NOT NULL, SITE_ID varchar(99) NOT NULL, VALUE text NULL, PRIMARY KEY (GROUP_ID, NAME));
CREATE TABLE content_dropbox_changes (DROPBOX_ID varchar(255) NOT NULL, ID int NOT NULL, IN_COLLECTION varchar(255) NULL, LAST_UPDATE varchar(24) NULL, PRIMARY KEY (ID));
CREATE TABLE content_resource (BINARY_ENTITY image NULL, CONTEXT varchar(99) NULL, FILE_PATH varchar(128) NULL, FILE_SIZE int NULL, ID int NOT NULL, IN_COLLECTION varchar(255) NULL, RESOURCE_ID varchar(255) NOT NULL, RESOURCE_TYPE_ID varchar(255) NULL, RESOURCE_UUID varchar(36) NULL, XML text NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_site_group (DESCRIPTION text NULL, GROUP_ID varchar(99) NOT NULL, ID int NOT NULL, SITE_ID varchar(99) NOT NULL, TITLE varchar(99) NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_site_tool_property (NAME varchar(99) NOT NULL, SITE_ID varchar(99) NOT NULL, TOOL_ID varchar(99) NOT NULL, VALUE text NULL, PRIMARY KEY (NAME, TOOL_ID));
CREATE TABLE SAKAI_SITE_PAGE (ID int NOT NULL, LAYOUT char(1) NULL, PAGE_ID varchar(99) NOT NULL, POPUP char(1) NULL, SITE_ID varchar(99) NOT NULL, SITE_ORDER int NOT NULL, TITLE varchar(99) NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_realm_role (ROLE_KEY int NOT NULL, ROLE_NAME varchar(99) NOT NULL, PRIMARY KEY (ROLE_KEY));
CREATE TABLE sakai_realm_function (FUNCTION_KEY int NOT NULL, FUNCTION_NAME varchar(99) NOT NULL, ID int NOT NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_user_id_map (EID varchar(255) NOT NULL, USER_ID varchar(99) NOT NULL, PRIMARY KEY (USER_ID));
CREATE TABLE SAKAI_CLUSTER (ID int NOT NULL, SERVER_ID varchar(64) NOT NULL, UPDATE_TIME datetime NULL, PRIMARY KEY (ID));
CREATE TABLE SAKAI_REALM_PROVIDER (PROVIDER_ID varchar(200) NOT NULL, REALM_KEY int NOT NULL, PRIMARY KEY (PROVIDER_ID, REALM_KEY));
CREATE TABLE sakai_digest (DIGEST_ID varchar(99) NOT NULL, ID int NOT NULL, XML text NULL, PRIMARY KEY (ID));
CREATE TABLE content_type_registry (CONTEXT_ID varchar(99) NOT NULL, ENABLED varchar(1) NULL, ID int NOT NULL, RESOURCE_TYPE_ID varchar(255) NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_user (CREATEDBY varchar(99) NOT NULL, CREATEDON datetime NOT NULL, EMAIL varchar(255) NULL, EMAIL_LC varchar(255) NULL, FIRST_NAME varchar(255) NULL, ID int NOT NULL, LAST_NAME varchar(255) NULL, MODIFIEDBY varchar(99) NOT NULL, MODIFIEDON datetime NOT NULL, PW varchar(255) NULL, TYPE varchar(255) NULL, USER_ID varchar(99) NOT NULL, PRIMARY KEY (ID));
CREATE TABLE content_collection (BINARY_ENTITY image NULL, COLLECTION_ID varchar(255) NOT NULL, ID int NOT NULL, IN_COLLECTION varchar(255) NULL, XML text NULL, PRIMARY KEY (ID));
CREATE TABLE content_resource_body_binary (BODY image NULL, ID int NOT NULL, RESOURCE_ID varchar(255) NOT NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_alias (ALIAS_ID varchar(99) NOT NULL, CREATEDBY varchar(99) NOT NULL, CREATEDON datetime NOT NULL, ID int NOT NULL, MODIFIEDBY varchar(99) NOT NULL, MODIFIEDON datetime NOT NULL, TARGET varchar(255) NULL, PRIMARY KEY (ID));
CREATE TABLE sakai_notification (ID binary NOT NULL, NOTIFICATION_ID varchar(99) NOT NULL, XML text NULL, PRIMARY KEY (ID));
CREATE TABLE SAKAI_SITE_PROPERTY (NAME varchar(99) NOT NULL, SITE_ID varchar(99) NOT NULL, VALUE text NULL, PRIMARY KEY (NAME, SITE_ID));
CREATE TABLE SAKAI_REALM_ROLE_DESC (DESCRIPTION text NULL, PROVIDER_ONLY char(1) NULL, REALM_KEY int NOT NULL, ROLE_KEY int NOT NULL, PRIMARY KEY (REALM_KEY, ROLE_KEY));
CREATE TABLE SAKAI_REALM_RL_GR (ACTIVE char(1) NULL, PROVIDED char(1) NULL, REALM_KEY int NOT NULL, ROLE_KEY int NOT NULL, USER_ID varchar(99) NOT NULL, PRIMARY KEY (REALM_KEY, USER_ID));
CREATE TABLE SAKAI_REALM_RL_FN (FUNCTION_KEY int NOT NULL, REALM_KEY int NOT NULL, ROLE_KEY int NOT NULL, PRIMARY KEY (FUNCTION_KEY, REALM_KEY, ROLE_KEY));
CREATE TABLE SAKAI_REALM (CREATEDBY varchar(99) NULL, CREATEDON datetime NULL, ID int NOT NULL, MAINTAIN_ROLE int NULL, MODIFIEDBY varchar(99) NULL, MODIFIEDON datetime NULL, PROVIDER_ID varchar(1024) NULL, REALM_ID varchar(255) NOT NULL, REALM_KEY int NOT NULL, PRIMARY KEY (ID));
ALTER TABLE SAKAI_REALM_ROLE_DESC ADD FOREIGN KEY (ROLE_KEY) REFERENCES sakai_realm_role (ROLE_KEY);
ALTER TABLE SAKAI_REALM_RL_GR ADD FOREIGN KEY (ROLE_KEY) REFERENCES sakai_realm_role (ROLE_KEY);
ALTER TABLE SAKAI_REALM_RL_FN ADD FOREIGN KEY (ROLE_KEY) REFERENCES sakai_realm_role (ROLE_KEY);
ALTER TABLE SAKAI_REALM ADD FOREIGN KEY (MAINTAIN_ROLE) REFERENCES sakai_realm_role (ROLE_KEY);
CREATE TABLE AUTO_PK_SUPPORT (  TABLE_NAME CHAR(100) NOT NULL,  NEXT_ID INTEGER NOT NULL,  PRIMARY KEY(TABLE_NAME));
DELETE FROM AUTO_PK_SUPPORT WHERE TABLE_NAME IN ('SAKAI_ALIAS_PROPERTY', 'SAKAI_CLUSTER', 'SAKAI_REALM', 'SAKAI_REALM_PROPERTY', 'SAKAI_REALM_PROVIDER', 'SAKAI_REALM_RL_FN', 'SAKAI_REALM_RL_GR', 'SAKAI_REALM_ROLE_DESC', 'SAKAI_SITE_PAGE', 'SAKAI_SITE_PROPERTY', 'SAKAI_SITE_TOOL', 'SAKAI_USER_PROPERTY', 'content_collection', 'content_dropbox_changes', 'content_resource', 'content_resource_body_binary', 'content_resource_delete', 'content_resource_lock', 'content_type_registry', 'sakai_alias', 'sakai_digest', 'sakai_event', 'sakai_locks', 'sakai_notification', 'sakai_preferences', 'sakai_realm_function', 'sakai_realm_role', 'sakai_session', 'sakai_site', 'sakai_site_group', 'sakai_site_group_property', 'sakai_site_page_property', 'sakai_site_tool_property', 'sakai_site_user', 'sakai_user', 'sakai_user_id_map');
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_ALIAS_PROPERTY', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_CLUSTER', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_REALM', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_REALM_PROPERTY', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_REALM_PROVIDER', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_REALM_RL_FN', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_REALM_RL_GR', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_REALM_ROLE_DESC', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_SITE_PAGE', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_SITE_PROPERTY', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_SITE_TOOL', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('SAKAI_USER_PROPERTY', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('content_collection', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('content_dropbox_changes', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('content_resource', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('content_resource_body_binary', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('content_resource_delete', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('content_resource_lock', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('content_type_registry', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_alias', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_digest', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_event', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_locks', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_notification', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_preferences', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_realm_function', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_realm_role', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_session', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_site', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_site_group', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_site_group_property', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_site_page_property', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_site_tool_property', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_site_user', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_user', 200);
INSERT INTO AUTO_PK_SUPPORT (TABLE_NAME, NEXT_ID) VALUES ('sakai_user_id_map', 200);
if exists (SELECT * FROM sysobjects WHERE name = 'auto_pk_for_table') BEGIN DROP PROCEDURE auto_pk_for_table END;
 CREATE PROCEDURE auto_pk_for_table @tname VARCHAR(32), @pkbatchsize INT AS BEGIN BEGIN TRANSACTION UPDATE AUTO_PK_SUPPORT set NEXT_ID = NEXT_ID + @pkbatchsize WHERE TABLE_NAME = @tname SELECT NEXT_ID FROM AUTO_PK_SUPPORT WHERE TABLE_NAME = @tname COMMIT END;
