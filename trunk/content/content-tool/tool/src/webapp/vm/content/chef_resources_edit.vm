## version: $Id:  $
<!-- chef_resources_edit.vm, use with org.sakaiproject.tool.content.ResourcesAction.java -->

############################################# macro editPropertyValues 
##
#macro(editPropertyValues $tags)
	#foreach($tag in $tags)
		#if($tag && $tag.label && "$!{tag.label}" != "")
			#set($indent = "")
			#if($tag.depth > 0)
				#set($indent = " indnt$!{tag.depth}")
			#end
			#if("$!NESTED" == "$!tag.widget")
				<div class="fakelabel$!{indent}">
					#if($tag.minCardinality > 0)<span class="reqStar">*</span>#end
					$tag.label
					#if($tag.canAddInstances())
						[<a href="#" onclick="javascript: document.getElementById('flow').value='addInstance'; document.getElementById('field').value='$!{tag.dottedname}'; submitform('propertyForm'); return false;" title="$tlang.getString("gen.add") $tag.label">+</a>]
					#end
					<input type="hidden"
						name="$!{tag.dottedname}" 
						id="$validator.escapeJavascript("$!{tag.dottedname}")" 
						value="" />
				</div>
			#else
				<div class="shorttext$!{indent}">
					<label for ="$validator.escapeJavascript("$!{tag.dottedname}")">
						#if($tag.minCardinality > 0)<span class="reqStar">*</span>#end
						$tag.label
						#if($tag.canAddInstances())
							[<a href="#" onclick="javascript: document.getElementById('flow').value='addInstance'; document.getElementById('field').value='$!{tag.dottedname}'; submitform('propertyForm'); return false;" title="$tlang.getString("gen.add") $tag.label">+</a>]
						#end
					</label>
					#if("$!tag.widget" == "$!STRING")
						<input type="text" size="$!{tag.length}"
							name="$!{tag.dottedname}" 
							id="$validator.escapeJavascript("$!{tag.dottedname}")" 
							value="$!{tag.value}" />
					#elseif("$!tag.widget" == "$!TEXTAREA")
						<textarea rows="4" cols="60" 
							name="$!{tag.dottedname}" 
							id="$validator.escapeJavascript("$!{tag.dottedname}")" >$validator.escapeHtmlTextarea($!{tag.value})</textarea>
					#elseif("$!tag.widget" == "$!WYSIWYG")
						<table><tr><td>
						<textarea rows="30" cols="80" 
							name="$!{tag.dottedname}" 
							id="$validator.escapeJavascript("$!{tag.dottedname}")" >$validator.escapeHtmlTextarea($!{tag.value}) </textarea>
						#chef_setupformattedtextarea("$validator.escapeJavascript($!{tag.dottedname})")
						</td></tr></table>
					#elseif("$!tag.widget" == "$!DATE")
						<input type="hidden" id="$validator.escapeJavascript("$!{tag.dottedname}")" value="" />
						#if($!{tag.value})
							#set($theValue = $!{tag.value})
						#else
							#set($theValue = $today)
						#end 
						#prop_dateSelectionWidget("${tag.dottedname}" $theValue)
					#elseif("$!tag.widget" == "$!DATETIME")
						<input type="hidden" id="$validator.escapeJavascript("$!{tag.dottedname}")" value="" />
						#if($!{tag.value})
							#set($theValue = $!{tag.value})
						#else
							#set($theValue = $today)
						#end 
						#prop_dateSelectionWidget("$!{tag.dottedname}" $theValue)
						#prop_timeSelectionWidget("$!{tag.dottedname}" $theValue)
					#elseif("$!tag.widget" == "$!TIME")
						<input type="hidden" id="$validator.escapeJavascript("$!{tag.dottedname}")" value="" />
						#if($!{tag.value})
							#set($theValue = $!{tag.value})
						#else
							#set($theValue = $today)
						#end 
						#prop_timeSelectionWidget("$!{tag.dottedname}" $theValue)
					#elseif("$!tag.widget" == "$!ENUM")
						<select name="$!{tag.dottedname}" 
							id="$validator.escapeJavascript("$!{tag.dottedname}")">
							#foreach($enum in $tag.enumeration)
								<option value="$enum"#if("$!{tag.value}" == "$enum") selected="selected"#end>$enum</option>
							#end
						</select>
					#elseif("$!tag.widget" == "$!BOOLEAN")
						<input type="checkbox" 
							name="$!{tag.dottedname}" 
							id="$validator.escapeJavascript("$!{tag.dottedname}")"
							#if("$!{tag.value}" == "$TRUE")checked="checked"#end
							value="true" />
					#elseif("$!tag.widget" == "$!INTEGER")
						<input type="text" size="$!{tag.length}"
							name="$!{tag.dottedname}" 
							id="$validator.escapeJavascript("$!{tag.dottedname}")" 
							value="$!{tag.value}" />
					#elseif("$!tag.widget" == "$!DOUBLE")
						<input type="text" size="$!{tag.length}"
							name="$!{tag.dottedname}" 
							id="$validator.escapeJavascript("$!{tag.dottedname}")" 
							value="$!{tag.value}" />
					#elseif("$!tag.widget" == "$!ANYURI")
						#set ($size = 0)
						#if (!$tag.values.isEmpty())
							#set ($props = false)
							#set ($size = $tag.values.size())
							<ul class="attachList">
								#foreach ($attachment in $tag.values)
									#set ($props = $attachment.Properties)
									#if (!$props)
										#if ($size > 0) #set ($size = $size - 1) #end
									#else
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<li><img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" />
										#else
											<li><img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" />
										#end
										#set ($copyflag = false)
										#if ($props.getProperty("CHEF:copyrightalert"))
											#if ($props.getBooleanProperty("CHEF:copyrightalert"))
												#set ($copyflag = true)
											#end
										#end
				
										#if ($copyflag)
											## if there is a copyright alert, show the alert page first
											<a href="" onclick="openCopyrightWindow('${attachment.url}','copyrightAlertWindow','scrollbars=yes,menubar=yes,height=600,width=800,resizable=yes,toolbar=yes,location=yes,status=yes');return false">
											$validator.escapeHtml($attachment.Properties.getPropertyFormatted("DAV:displayname"))</a>&#169;
										#else
											<a href="$attachment.Url" target="_blank">
											$validator.escapeHtml($attachment.Properties.getPropertyFormatted("DAV:displayname"))</a>
										#end
										
										#if (!$props.getBooleanProperty($props.NamePropIsCollection))
												($props.getPropertyFormatted($props.NamePropContentLength))
										#end
									#end
									</li>
									#set ($props = false)
								#end
							</ul>
						#end
						#if ($size == 0) 
							## $tlang.getString("gen.noattach")
							<div class="act">
								<a href="#" onclick="javascript:document.getElementById('propertyForm').action='#toolLinkParam("ResourcesAction" "doSavechanges" "special=upload&flow=linkResource&field=$validator.escapeUrl($tag.dottedname)")';submitform('propertyForm');">Link to a resource</a>
							</div>
						#else
							<div class="act">
								<a href="#" onclick="javascript:document.getElementById('propertyForm').action='#toolLinkParam("ResourcesAction" "doSavechanges" "special=upload&flow=linkResource&field=$validator.escapeUrl($tag.dottedname)")';submitform('propertyForm');">Link to a resource</a>
							</div>
						#end
					#else
						$tag.dottedname<br />
						$tag.widget<br />
						"$!{tag.value}"<br />
					#end
				</div>
			#end
		#end
	#end
#end
############################################# end of macro editPropertyValues 
##
############################################# macro prop_dateSelection 
#macro(prop_dateSelectionWidget $propName $propValue)
## Setup a date selection widget
#set($theDate = $propValue.breakdownLocal())
#set($year = $theDate.year)
#set($earliestYear = $year - 10)
#set($latestYear = $year + 10)	
#set($month = $theDate.month)
#set($day = $theDate.day)
#chef_dateselectionwidget("${propName}_year" "${propName}_month" "${propName}_day" $earliestYear $latestYear $year $month $day)
#end
############################################# end of macro prop_dateSelection 
##
############################################# macro prop_timeSelection 
#macro(prop_timeSelectionWidget $propName $propValue)
## Setup a time selection widget
#set($theTime = $propValue.breakdownLocal())
#set($hour = $theTime.hour)
#set($minute = $theTime.min)
#set($second = $theTime.sec)
#set($timeType = "am")
#if($hour == 12 && $minute > 0)
#set($timeType = "pm")
#end
#if($hour == 0 && $minute == 0)
#set($timeType = "pm")
#end
#if($hour>12)
#set($hour = $hour - 12)
#set($timeType = "pm")
#elseif ($hour == 0)
#set($hour = 12)
#end
<select name="${propName}_hour" id="${propName}_hour">
#foreach($hr in [1..12])
	<option#if($hr == $hour) selected="selected"#end value="$hr">$hr</option>
#end
</select>
:
<select name="${propName}_minute" id="${propName}_minute">
#foreach($min in [0..59])
	<option value="$min"#if($min == $minute) selected="selected"#end>#if($min < 10)0#end$min</option>
#end
</select>
:
<select name="${propName}_second" id="${propName}_second">
#foreach($sec in [0..59])
	<option value="$sec"#if($sec == $second) selected="selected"#end>#if($sec < 10)0#end$sec</option>
#end
</select>
<select name="${propName}_ampm" id="${propName}_ampm">
    #if($timeType =="am") <option selected="selected">am</option> #else <option>am</option> #end
    #if($timeType =="pm") <option selected="selected">pm</option> #else <option>pm</option> #end
</select>
#end
############################################# end of macro prop_timeSelection 
##
<script language="JavaScript" type="text/javascript">
	<!--
	function submitform(id)
	{
		var theForm = document.getElementById(id);
		if(theForm && theForm.onsubmit)
		{
			theForm.onsubmit();
		}
		if(theForm && theForm.submit)
		{
			theForm.submit();
		}
	}
	function openSampleCopyrightWindow() 
	{ 
	  window.open("$copyright_alert_url","SampleCopyrightAlert","scrollbars=no,menubar=no,height=400,width=700,resizable=no,toolbar=no,location=no,status=no");
	  return false;
	}
	function enableNewCopyright(obj_mycopyright, obj_newcopyright)
	{
		obj_mycopyright.checked = false;
		obj_newcopyright.checked = true;
	}

	function clearNewCopyright(obj_textarea)
	{
		obj_textarea.value = "";
	}
	
	function checkItem(copyrightIndex)
	{
		var obj_alert_name="copyrightAlert";
		var obj_alert_item=document.getElementById(obj_alert_name);
		var obj_newcopyright_name="newcopyright";
		var obj_newcopyright_item=document.getElementById(obj_newcopyright_name);
		if (copyrightIndex == 0)
		{
			obj_alert_item.checked=false;
			obj_newcopyright_item.disabled=true;
		}
		else if (copyrightIndex < 5)
		{
			obj_alert_item.checked=true;
			obj_newcopyright_item.disabled=true;
		}
		else if (copyrightIndex == 5)
		{
			obj_alert_item.checked=true;
			obj_newcopyright_item.disabled=false;
		}
	}
	function changeMimeType(category, subtype)
	{
		var mime_widget_div = document.getElementById('mime_widget');
		var select_category = "<select name=\"mime_category\" id=\"mime_category\" onchange=\"javascript:changeMimeCategory(this);\">\n";
		for(var i = 0; i < mimeCategories.length; i++)
		{
			if(category == mimeCategories[i])
			{
				select_category += "<option selected=\"selected\">" + mimeCategories[i] + "</option>\n";				
			}
			else
			{
				select_category += "<option>" + mimeCategories[i] + "</option>\n";
			}
		}
		select_category += "</select>\n";
		var select_subtype = "<span id=\"mime_subtype\">\n<select name=\"mime_subtype\">\n";
		for(var i = 0; i < mimeSubtypes[category].length; i++)
		{
			if(subtype == mimeSubtypes[category][i])
			{
				select_subtype += "<option selected=\"selected\">" + mimeSubtypes[category][i] + "</option>\n";				
			}
			else
			{
				select_subtype += "<option>" + mimeSubtypes[category][i] + "</option>\n";
			}
		}
		select_subtype += "</select>\n</span>\n";

		mime_widget_div.innerHTML = select_category + "/" + select_subtype;
	}
	function changeMimeCategory(element)
	{
		var subtype_widget_div = document.getElementById("mime_subtype");
		var mime_warning_div = document.getElementById("mime_warning");
		var category = element.options[element.selectedIndex].text;
		// var category = element.value;
		var select_subtype = "<select name=\"mime_subtype\">\n";
		for(var i in mimeSubtypes[category])
		{
			if(i == 0)
			{
				select_subtype += "<option selected=\"selected\">" + mimeSubtypes[category][i] + "</option>\n";				
			}
			else
			{
				select_subtype += "<option>" + mimeSubtypes[category][i] + "</option>\n";
			}
		}
		select_subtype += "</select>\n";
		subtype_widget_div.innerHTML = select_subtype;
		if(category == "text")
		{
			mime_warning_div.innerHTML = "<div class=\"alertMessage\">$tlang.getString("gen.alert") $tlang.getString("edit.mime")</div>\n";
		}
		else
		{
			mime_warning_div.innerHTML = "";
		}
	}
	function updateCopyright(element)
	{
		var cr_div = document.getElementById("copyright_status");
		var new_value = element.value;
		var cr_element = document.getElementById("newcopyright");
		var cr_value = cr_element.value;
		
		var inner_html = "";
		if(new_value == "$USE_THIS_COPYRIGHT")
		{
			inner_html = "<p class=\"shorttext\">\n<span class=\"reqStar\">*</span>\n" 
						+ "<label for=\"newcopyright\">\n$tlang.getString("edit.cinfo")\n</label>\n"
						+ "<textarea name=\"newcopyright\" id=\"newcopyright\" rows=\"2\" cols=\"40\" wrap=\"virtual\" ></textarea>\n</p>\n";	
		}
		else
		{
			inner_html = "<input type=\"hidden\" name=\"newcopyright\" id=\"newcopyright\" value=\"\" />";
		}
		cr_div.innerHTML = inner_html;
		setMainFrameHeight('$validator.escapeJavascript("Main$pid")');	
		cr_element = document.getElementById("newcopyright");
		cr_element.value = cr_value;
		if(new_value == "$USE_THIS_COPYRIGHT")
		{
			cr_element.select();
			cr_element.focus();
		}
	}
	function checkForFile(elementId)
	{
		var element = document.getElementById(elementId);
		var check = document.getElementById("check_" + elementId);
		if(element && element.value && element.value != "" && check)
		{
			check.value = "true";
		}
		else if(check)
		{
			check.value = "false";
		}
	}
	

	function toggleSelectAll(element, item_name)
	{
		var checkboxes = document.getElementsByName(item_name);
		for(var i = 0; i < checkboxes.length; i++)
		{
			if(element.checked)
			{
				checkboxes[i].checked = true;
			}
			else
			{
				checkboxes[i].checked = false;
			}
		}
	}
	-->
</script>
<div class="portletBody">
	<h3>
		#if($helper_title)
			$helper_title
		#elseif($item.isFolder())
			$tlang.getString("edit.folder")
		#else
			$tlang.getString("edit.edit") 
		#end
	</h3>
	
	#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div>#end
	#if($helper_instruction)
		<p class="instruction">
			$helper_instruction
		</p>
	#end
	<p class="instruction">
		$tlang.getString("edit.instr") <span class="reqStarInline">*</span>
	</p>
	<div class ="breadCrumb">
		<h3>
		$tlang.getString("gen.location")
		<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="" />
		#foreach ($element in $collectionPath)
			#if ($dropboxMode && $element.id==$homeCollectionId)
				$siteTitle $tlang.getString("gen.drop")
			#elseif($element.id==$homeCollectionId)
				$siteTitle $tlang.getString("gen.reso")
			#else
				$validator.escapeHtml($element.name)
			#end
			#if(! $element.isLast())
				/
			#end
		#end
		</h3>
	</div>	
	#if($item.isFileUpload() || "$REPLACE" == "$intent")
   		<form name="propertyForm" id="propertyForm" action="#toolLinkParam("ResourcesAction" "doSavechanges" "special=upload&flow=update")" method="post" enctype="multipart/form-data">
	#else
	   <form name="propertyForm" id="propertyForm" action="#toolLinkParam("ResourcesAction" "doSavechanges" "flow=update")" method="post">
	#end
		<input type="hidden" name="sakai_action" value="doSavechanges" />
		<input type="hidden" name="flow" id="flow" value="update" />
		<input type="hidden" name="collectionId" value="$validator.escapeHtml($collectionId)" />
		<input type="hidden" name="stateName" value = "list" />
		<input type="hidden" name="from" value="list" />
		<input type="hidden" name="option" id="option" value="replace" />
		<input type="hidden" name="metadataGroup" id="metadataGroup" value="" />
		<input type="hidden" name="ContentType" value="$item.MimeType" />
		<input type="hidden" name="itemType" id="itemType" value="$item.type" />
		<!-- $item.type $item.MimeType -->
		<input type="hidden" name="field"  id="field" value="no value" />
		<input type="hidden" name="index" id="index" value="0" />
		
		<p class="shorttext">
			#if (! $atHome)						 
				<span class="reqStar">*</span>
			#end
			<label for="name">
				$tlang.getString("gen.title") 
			</label>
			#if (! $atHome)						 
				<input type="text" size="40" id="name" name="name" value="$validator.escapeHtml("$!item.name")" />
			#else
				$!item.name
				<input type="hidden" name="name" id="name" value="$validator.escapeUrl("$!item.name")" />
			#end
		</p>	
		#if (! $item.isFolder()) 
			#if ($item.isUrl())
				<p class="shorttext">
					<label for="Url">$tlang.getString("edit.replace2")</label>
					<input type="text" name="Url" id="Url" size="60" value="$!{item.contentstring}" />
				</p>
			#elseif ($item.isPlaintext() || $item.isHtml())
				<p class="shorttext">
					<label for="intent">$tlang.getString("gen.content")</label>
					<select name="intent" id="intent" onchange="javascript: document.getElementById('propertyForm').action='#toolLinkParam("ResourcesAction" "doSavechanges" "special=upload&flow=intentChanged")'; submitform('propertyForm');">
						<option id="intent-revise" value="revise"#if("$intent" == "$REVISE") selected="selected"#end>Revise document contents below</option>
						<option id="intent-replace" value="replace"#if("$intent" == "$REPLACE") selected="selected"#end>Replace with document from my computer</option>
					</select>
				</p>
				#if("$REVISE" == "$intent")
					#if ($item.isPlaintext()) 
						<p class="longtext"> 
							<textarea name="content" id="content" rows="10" cols="60" wrap="virtual">$validator.escapeHtmlTextarea("$!{item.contentstring}")</textarea>
						</p>
					#elseif ($item.isHtml())
						<div class="longtext"> 
							<table border="0"><tr><td>
								<textarea name="content" id="content" rows="30" cols="80" wrap="virtual">$validator.escapeHtmlTextarea("$!{item.contentstring}")</textarea>
								#chef_setupformattedtextarea("content")
							</td></tr></table>
						</div>
					#end
				#else
					<table class="itemSummary" border="0" style="clear:both;margin:left:.7em">
						<tr> 
							<td style="width:180px;padding-left:.7em"> 
								<label>$tlang.getString("edit.filename")</label>
							</td>
							<td>
								$validator.escapeHtml("$!item.filename")
							</td>
						</tr>
					</table>
					<p class="shorttext">
						<label for="fileName">$tlang.getString("rep.thisfile")</label>
						<input type="file" name="fileName" id="fileName" class="upload" onchange="javascript:checkForFile('fileName');" />
						<input type="hidden" name="check_fileName" id="check_fileName" value="false" /> 
					</p>
				#end
			#else
				<table class="itemSummary" border="0" style="clear:both;margin:left:.7em">
					<tr> 
						<td style="width:180px;padding-left:.7em"> 
							<label>$tlang.getString("edit.filename")</label>
						</td>
						<td>
							$validator.escapeHtml("$!item.filename")
						</td>
					</tr>
				</table>
				<p class="shorttext">
					<label for="fileName">$tlang.getString("rep.thisfile")</label>
					<input type="file" name="fileName" id="fileName"  class ="upload" onchange="javascript:checkForFile('fileName');" />
					<input type="hidden" name="check_fileName" id="check_fileName" value="false" /> 
				</p>
			#end
		#end
		######################## ================ Properties of Item ================ ########################
		<p class="discTria">
			$tlang.getString("add.props")
		</p>
		<p class="shorttext">
			<label for="description">
				$tlang.getString("gen.description")
			</label>
			<textarea id="description" name="description" rows="2" cols="40" wrap="virtual">$validator.escapeHtmlTextarea("$!item.description")</textarea>
		</p>	
		#if ($item.isFileUpload() || $item.isHtml() || $item.isPlaintext()) 
			##getRightsAssignment($item.rights)
			
			#if ($!copyrightTypes)
				<p class="shorttext">
					<span class="reqStar">*</span>
					<label for="copyright">
						$tlang.getString("edit.cstatus")
					</label>	
					<select name="copyright" id ="copyright" onchange="javascript:updateCopyright(this);">
						#foreach ($copyright in $copyrightTypes)
							<option value="$copyright"#if($item.copyrightStatus == $copyright) selected="selected"#end>$copyright</option>
						#end
					</select>
					#if ($!fairuseurl)
						(<a href="$fairuseurl" target="_blank" title="[$tlang.getString('gen.newwin')]"><span class="skip"> [$tlang.getString('gen.newwin')]</span>$tlang.getString("edit.fairuse")</a>)
					#end
				</p>
				<div id="copyright_status">
					#if($item.copyrightStatus == $USE_THIS_COPYRIGHT)
						<p class="shorttext">
							<span class="reqStar">*</span>
							<label for="newcopyright">
								$tlang.getString("edit.cinfo")
							</label>	
							<textarea name="newcopyright" id="newcopyright" rows="2" cols="40" wrap="virtual" >$validator.escapeHtmlTextarea("$!item.copyrightInfo")</textarea>
						</p>	
					#else
						<input type="hidden" name="newcopyright" id="newcopyright" value="$!item.copyrightInfo" />
					#end
				</div>
				<table border="0">
					<tr>
						<td style="width:180px;padding-left:1em;vertical-align:top">
							<label for="copyrightAlert">
								$tlang.getString("edit.calert")
							</label>
						</td>
						<td style="vertical-align:top">
							<input type="checkbox" name="copyrightAlert" id ="copyrightAlert" value="true" #if($item.hasCopyrightAlert())checked="checked"#end style="border:none" />
							$tlang.getString("edit.display1")
							<a href="#" onclick="javascript:openSampleCopyrightWindow();"   title="[$tlang.getString('gen.newwin')]"><span class="skip">[$tlang.getString('gen.newwin')]</span>$tlang.getString("edit.display2")</a>
							$tlang.getString("edit.display3")
						</td>
					</tr>
				</table>
			#end
		#end
		
		######### begin availability section ##########
		#if($availability_is_enabled && !$item.isInWorkspace() && !$dropboxMode)
		<h4>$tlang.getString("avail.title")</h4>
		<div  class="labelindnt">
			<table>
				<tr>
					<td>
						<input type="radio" name="hidden" id="hidden_false" value="false" #if(!$item.isHidden())checked="checked" #end/>
					</td>
					<td colspan="4">
						<label for="hidden_false">
							$tlang.getString("avail.show")
						</label>
					</td>
				</tr>
				<tr>
					<td>
					</td>
					<td>
						<input type="checkbox" name="use_start_date" id="use_start_date" value="true" #if($item.useReleaseDate())checked="checked" #end/>
					</td>
					<td colspan="3">
						<label for="use_start_date">
							$tlang.getString("avail.start")
						</label>
					</td>
				</tr>
				<tr>
					<td>
					</td>
					<td>
					</td>
					<td>
					</td>
					<td>
						<label for="release_year">Date:</label>
					</td>
					<td>
						<label for="release_hour">Time:</label>
					</td>
				</tr>
				#set($yearX = $item.releaseDate.breakdownLocal().year)
				#set($year0 = $yearX - 4)
				#set($yearN = $yearX + 4)
				#set($monthX = $item.releaseDate.breakdownLocal().month)
				#set($dayX = $item.releaseDate.breakdownLocal().day)
				<tr>
					<td>
					</td>
					<td>
					</td>
					<td>
					</td>
					<td>
						#custom_dateselectionwidget("release_year" "release_month" "release_day" $year0 $yearN $yearX $monthX $dayX "document.getElementById('hidden_true$i').checked=false;document.getElementById('hidden_false$i').checked=true;document.getElementById('use_start_date$i').checked=true;")
					</td>
					<td>
						#custom_timeSelectionWidget("release" $item.releaseDate "document.getElementById('hidden_true$i').checked=false;document.getElementById('hidden_false$i').checked=true;document.getElementById('use_start_date$i').checked=true;")
					</td>
				</tr>
				<tr>
					<td>
					</td>
					<td>
						<input type="checkbox" name="use_end_date" id="use_end_date" value="true" #if($item.useRetractDate())checked="checked" #end/>
					</td>
					<td colspan="4">
						<label for="use_end_date">
							$tlang.getString("avail.end")
						</label>
					</td>
				</tr>
				<tr>
					<td>
					</td>
					<td>
					</td>
					<td>
					</td>
					<td>
						<label for="retract_year">Date:</label>
					</td>
					<td>
						<label for="retract_time">Time:</label>
					</td>
				</tr>
				#set($yearX = $item.retractDate.breakdownLocal().year)
				#set($year0 = $yearX - 4)
				#set($yearN = $yearX + 4)
				#set($monthX = $item.retractDate.breakdownLocal().month)
				#set($dayX = $item.retractDate.breakdownLocal().day)
				<tr>
					<td>
					</td>
					<td>
					</td>
					<td>
					</td>
					<td>
						#custom_dateselectionwidget("retract_year" "retract_month" "retract_day" $year0 $yearN $yearX $monthX $dayX "document.getElementById('hidden_true$i').checked=false;document.getElementById('hidden_false$i').checked=true;document.getElementById('use_end_date$i').checked=true;")
					</td>
					<td>
						#custom_timeSelectionWidget("retract" $item.retractDate "document.getElementById('hidden_true$i').checked=false;document.getElementById('hidden_false$i').checked=true;document.getElementById('use_end_date$i').checked=true;")
					</td>
				</tr>
				<tr>
					<td>
						<input type="radio" name="hidden" id="hidden_true" value="true" #if($item.isHidden())checked="checked" #end/>
					</td>
					<td colspan="4">
						<label for="hidden_true">
							$tlang.getString("avail.hide")
						</label>
					</td>
				</tr>
			</table>
		</div>
		#end
		######### end availability section ##########
		
		######### begin access section ##########
		## Should initial access to this resource or collection be determined
		## for "site" (standard sakai permissions), "grouped" or "public"?
		## do not show any access options if in dropbox
		#if(!$dropboxMode)
			#set ($listDisplay="none")
			## show access options only if public view is allowed or there are groups in the site
			#if($item.isPubviewInherited())
				<h4>$tlang.getString("access.title2")</h4>
				<input type="hidden" name="access_mode" id="access_mode_hidden" value="$INHERITED_ACCESS" />
			#elseif($item.isSingleGroupInherited())
				<h4>$item.singleGroupTitle</h4>
				<input type="hidden" name="access_mode" id="access_mode_hidden" value="$INHERITED_ACCESS" />
			#elseif($item.isSiteOnly())
				<h4>$tlang.getString("access.title3")</h4>
				<input type="hidden" name="access_mode" id="access_mode_hidden" value="$INHERITED_ACCESS" />
			#elseif(!$item.isSitePossible())
				<h4>$tlang.getString("access.title5")</h4>
				#set ($listDisplay="block")
			#else
				<h4>$tlang.getString("access.title1")</h4>
				<div  class="labelindnt">
					#if($item.isPubviewPossible())
						<p class="checkbox">
							<input type="radio" name="access_mode" id="access_mode_public" value="public" #if($!item.isPubview()) checked="checked"#end  style="border:none" onclick="javascript:document.getElementById('groupTable').style.display='none';"  />
							<label for="access_mode_public">$tlang.getString("edit.access2")</label>
						</p>
					#end
					<p class="checkbox">
						<input type="radio" name="access_mode" id="access_mode_$INHERITED_ACCESS" value="$INHERITED_ACCESS" #if(!$item.isPubview() && ("$!item.access" == "$SITE_ACCESS" || "$!item.access" == "$INHERITED_ACCESS")) checked="checked"#end  style="border:none" onclick="javascript:document.getElementById('groupTable').style.display='none';"  />
						<label for="access_mode_site">$tlang.getString("edit.access3")</label>
					</p>
					
					#if($item.isGroupPossible())
						#if("$!item.access" == "$GROUP_ACCESS")
							#set ($listDisplay="block")
						#else
							#set ($listDisplay="none")
						#end
						<p class="checkbox">
							<input type="radio" name="access_mode" id="access_mode_$GROUP_ACCESS" value="$GROUP_ACCESS" #if("$!item.access" == "$GROUP_ACCESS") checked="checked"#end  style="border:none" onclick="javascript:document.getElementById('groupTable').style.display='block';"  />
							<label for="access_mode_$GROUP_ACCESS">$tlang.getString("edit.access4")</label>
						</p>
					#end
				</div>
			#end
			#if($item.isGroupPossible())
				<table id="groupTable" class="listHier lines labelindnt" border="0" style="width:80%;display:$listDisplay" cellspacing="0" summary="$tlang.getString("edit.group3")">
					<caption class="skip" style="display:none">$tlang.getString("edit.access4")</caption>
					<tr>
						<th id="selectAllGroups" style="width:2em;padding-left:.4em">
							<input type="checkbox" id="selectall" title="toggle select all" onclick="javascript:toggleSelectAll(this, 'access_groups')"  />
						</th>
						<th id="groupname">
							$tlang.getString("edit.group1")
						</th>
						<th id ="groupdescription">
							$tlang.getString("edit.group2")
						</th>
					</tr>
					#set($theGroups = $item.allSiteGroups)
					#foreach ($group in $!{theGroups})
						#if($item.isPossible($group))
							<tr>
								<td headers="selected" style="padding-bottom:0;" style="width:2em">
									#if($item.allowedRemove($group))
										<input type="checkbox" name="access_groups" id="access_groups_$group.Id" title="$group.title" value="$group.Id" #if($item.isLocal($group) || $item.isGroupInherited()) checked="checked"#end />
									#else
										<img src="#imageLink("sakai/checkon.gif")" border="0" width="17" height="13" align="top" />
									#end
								</td>
								<td headers="name" style="padding-bottom:0;" class="checkbox">
									<label for="access_groups_$group.Id">
										$group.Title
									</label>	
								</td>
								<td headers="description" width="100%"> ##mozilla does not resize table children dynamically , so set here
									#set($description = "")
									#if($group.Description)
										#set($description = $group.Description)
									#end
									$!description
								</td>
							</tr>
						#end
					#end
				</table>
			#end
		#end
		########## end access section ###########
	
		#if($item.canSetQuota())
			<p class="shorttext">
				<label for="hasQuota">
					$tlang.getString("gen.quota") ($tlang.getString("gen.kb")):
				</label>	
				<input type="hidden" name="setQuota" value="true" />
				<input type="checkbox" name="hasQuota" id="hasQuota" value="true"#if($item.hasQuota()) checked="checked" #end style="border:none" />
				<input type="text" size="10" name="quota" id="quota" value="$!item.quota" />
			</p>	
		#end
		<table class="itemSummary" border="0" style="clear:both;margin:left:.7em">
			#if (!($dropboxMode && $collectionId==$homeCollectionId))
				<tr> 
					<td style="width:180px;padding-left:.7em"> 
						<label>$tlang.getString("gen.created")</label>
					</td>
					<td>
						$validator.escapeHtml("$item.createdBy")
					</td>
				</tr>
			#end
			<tr> 
				<td style="width:180px;padding-left:.7em"> 
					<label>$tlang.getString("gen.creatime")</label>
				</td>
				<td>
					$validator.escapeHtml("$item.createdTime")
				</td>
			</tr>
			<tr> 
				<td style="width:180px;padding-left:.7em"> 
					<label>$tlang.getString("gen.last")</label>
				</td>
				<td>
					$validator.escapeHtml("$item.modifiedTime")
				</td>
			</tr>
			#if (!($dropboxMode && $atHome))
				<tr>
					<td style="width:180px;padding-left:.7em"> 
						<label>$tlang.getString("gen.lastby")</label>
					</td>
					<td>
						$validator.escapeHtml("$item.modifiedBy")
					</td>
				</tr>
			#end
			#if (! $item.isStructuredArtifact())
				<tr> 
					<td style="width:180px;padding-left:.7em"> 
						<label>$tlang.getString("gen.stored")</label>
					</td>
					<td>
						<a href="$item.url" target="_blank"   title="[$tlang.getString('gen.newwin')]">$item.url</a>
					</td>
				</tr>
				#if(! $item.isUrl())
					<tr> 
						<td style="width:180px;padding-left:.7em"> 
							<label>$tlang.getString("gen.type")</label>
						</td>
						<td>
							<span id="mime_warning"></span>
							<span id="mime_widget">
								$item.MimeType
								<input type="hidden" name="mime_category" id="mime_category" value="$item.mimeCategory" />  
								<input type="hidden" name="mime_subtype" id="mime_subtype" value="$item.mimeSubtype" />
								<input type="button" value="Change File Type" onclick="javascript:changeMimeType('$item.mimeCategory', '$item.mimeSubtype')" />
							</span>
						</td>
					</tr>
				#end
				<tr> 
					<td  style="width:180px;padding-left:.7em"> 
						<label>$tlang.getString("gen.size")</label>
					</td>
					<td>
						$item.size 
					</td>
				</tr>
			#end
		</table> 
		#if (!$dropboxMode)
			#if (!$item.isFolder())
				#if ($notification)
					<p class="shorttext">
						<label for="notify">
							$tlang.getString("gen.email1")
						</label>	
						<select name="notify" id="notify">
							<option value="r">$tlang.getString("gen.email2")</option>
							<option value="o">$tlang.getString("gen.email3")</option>
							<option value="n" selected="selected">$tlang.getString("gen.email4")</option>
						</select>
					</p>	
				#end
			#end
		#end
		
	
		############################################# this is the section to edit metadata  
		#if($metadataGroups)
			#foreach($group in $metadataGroups)				  
				#if ($group.isShowing())
					<p class="discTria">
						<a href="#" onclick="javascript:document.getElementById('propertyForm').action='#toolLinkParam("ResourcesAction" "doSavechanges" "special=upload&flow=hideMetadata&metadataGroup=$validator.escapeUrl($group.name)")';submitform('propertyForm');" title="$tlang.getString("edit.hide") $group.name">
							<img src="#imageLink("sakai/collapse.gif")" alt="$tlang.getString("edit.hide") $group.name" border="0" width="13" height="13" align="top" />
						</a>
						$validator.escapeHtml($group.name)
					</p>
					#foreach($tag in $group)
						<p class="shorttext">
							#if("$!tag.widget" == "$!STRING")
			 					<label for ="$validator.escapeJsQuoted("$!tag.fullname")">
									$tag.label
								</label>
								<input type="text" size="40"
									name="$!tag.fullname" 
									id="$validator.escapeJsQuoted("$!tag.fullname")" 
									value="$!item.metadata.get("$tag.fullname")" 
								/>
							#elseif("$!tag.widget" == "$!TEXTAREA")
								<label for ="$validator.escapeJsQuoted("$!tag.fullname")">
									$tag.label
								</label>
								<textarea rows="4" cols="30" 
									name="$!tag.fullname" 
									id="$validator.escapeJsQuoted("$!tag.fullname")" >$validator.escapeHtmlTextarea($item.metadata.get("$tag.fullname"))</textarea>
	
							#elseif("$!tag.widget" == "$!DATE")
								<label for ="$validator.escapeJsQuoted("$!tag.fullname")">
									$tag.label
								</label>
								<input type="hidden" id="$validator.escapeJsQuoted("$!tag.fullname")" value="" />
								#if($!item.metadata.get("$tag.fullname"))
									#set($theValue = $!item.metadata.get("$tag.fullname"))
								#else
									#set($theValue = $today)
								#end 
								#prop_dateSelectionWidget(${tag.fullname} $theValue)
							#elseif("$!tag.widget" == "$!DATETIME")
								<label for ="$validator.escapeJsQuoted("$!tag.fullname")">
									$tag.label
								</label>
								<input type="hidden" id="$validator.escapeJsQuoted("$!tag.fullname")" value="" />
								#if($!item.metadata.get("$tag.fullname"))
									#set($theValue = $!item.metadata.get("$tag.fullname"))
								#else
									#set($theValue = $today)
								#end 
								#prop_dateSelectionWidget(${tag.fullname} $theValue)
								#prop_timeSelectionWidget(${tag.fullname} $theValue)
							#elseif("$!tag.widget" == "$!TIME")
								<label for ="$validator.escapeJsQuoted("$!tag.fullname")">
									$tag.label
								</label>
								<input type="hidden" id="$validator.escapeJsQuoted("$!tag.fullname")" value="" />
								#if($!item.metadata.get("$tag.fullname"))
									#set($theValue = $!item.metadata.get("$tag.fullname"))
								#else
									#set($theValue = $today)
								#end 
								#prop_timeSelectionWidget(${tag.fullname} $theValue)
	
							#else
								$tag.fullname<br />
								$tag.widget<br />
								$!item.metadata.get("$tag.fullname")<br />
							#end
						</p>
					#end
					
				#else
					<p class="discTria">
						##<a href="#" onclick="javascript: document.getElementById('flow').value='showMetadata'; document.getElementById('metadataGroup').value='$validator.escapeUrl($group.name)'; submitform('propertyForm'); return false;" title="$tlang.getString("edit.hide") $metadataGroup.name">	
						<a href="#" onclick="javascript:document.getElementById('propertyForm').action='#toolLinkParam("ResourcesAction" "doSavechanges" "special=upload&flow=showMetadata&metadataGroup=$validator.escapeUrl($group.name)")';submitform('propertyForm');" title="$tlang.getString("edit.show") $group.name">
							<img src="#imageLink("sakai/expand.gif")" alt="$tlang.getString("edit.show") $group.name" border="0" width="15" height="15" align="top" />
						</a>
						$validator.escapeHtml($group.name)
					</p>
				#end
			#end
		#end
		############################################# end of section to show metadata 
	
		<p class="act">
	##if("$itemType" == "$TYPE_UPLOAD") 
	#if($item.isFileUpload())
			<input type="button" class="active" name="doSavechanges" onclick="document.getElementById('propertyForm').action='#toolLinkParam("ResourcesAction" "doSavechanges" "special=upload&flow=update")';submitform('propertyForm');" value="$tlang.getString("edit.update")" accesskey="s" />
	#else
			<input type="button" class="active" name="doSavechanges" onclick="document.getElementById('propertyForm').action='#toolLinkParam("ResourcesAction" "doSavechanges" "flow=update")';submitform('propertyForm');" value="$tlang.getString("edit.update")" accesskey="s" />
	#end
			<input type="button" name="doCancel" onclick="javascript:document.getElementById('propertyForm').action='#toolLinkParam("ResourcesAction" "doSavechanges" "flow=cancel")';submitform('propertyForm');" value="$tlang.getString("gen.cancel")" accesskey="x" />
		</p>
		
	</form>
</div>
<script type="text/javascript">
<!--
	var mimeCategories = new Array();
#set($count = 0)
#foreach($category in $contentTypeImageService.MimeCategories)
	mimeCategories[$count] = "$category";
#set($count = $count + 1)
#end
	var mimeSubtypes = new Array();
#foreach($category in $contentTypeImageService.MimeCategories)
	mimeSubtypes["$category"] = new Array();
#set($count = 0)
#foreach($subtype in $contentTypeImageService.getMimeSubtypes("$category"))
	mimeSubtypes["$category"][$count] = "$subtype"
#set($count = $count + 1)
#end
#end
-->
</script>

